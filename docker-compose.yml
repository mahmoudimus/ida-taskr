version: '3.8'

services:
  # IDA Pro 9.1 (PyQt5) - Development service
  idapro-91:
    image: ghcr.io/mahmoudimus/idapro-linux:9.1-pyqt5
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
      - ida-user-91:/ida/user
    working_dir: /workspace
    ports:
      - "65433:65433"

  # IDA Pro 9.2 (PySide6) - Development service
  idapro-92:
    image: ghcr.io/mahmoudimus/idapro-linux:9.2-pyside6
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
      - ida-user-92:/ida/user
    working_dir: /workspace
    ports:
      - "65434:65434"

  # IDA Pro 9.1 test runner - Uses baked image with pre-configured environment
  idapro-tests-91:
    image: ghcr.io/mahmoudimus/idapro-linux:baked
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
      - PYTHONPATH=/opt/ida/python/3:/workspace
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
    working_dir: /workspace
    command: /opt/ida/python/3/bin/python3 -m pytest tests/integration/ -v --tb=short

  # IDA Pro 9.2 test runner - Uses 9.2-specific image
  idapro-tests-92:
    image: ghcr.io/mahmoudimus/idapro-linux:9.2-pyside6
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
      - PYTHONPATH=/opt/ida/python/3:/workspace
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
    working_dir: /workspace
    command: /opt/ida/python/3/bin/python3 -m pytest tests/integration/ -v --tb=short

volumes:
  ida-user-91:
  ida-user-92:
