services:
  # IDA Pro 9.1 (PyQt5) - Development service
  idapro-91:
    image: ghcr.io/mahmoudimus/idapro-linux:9.1-pyqt5
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
      - ida-user-91:/ida/user
    working_dir: /workspace
    ports:
      - "65433:65433"

  # IDA Pro 9.2 (PySide6) - Development service
  idapro-92:
    image: ghcr.io/mahmoudimus/idapro-linux:9.2-pyside6
    environment:
      - TZ=America/Los_Angeles
      - DISPLAY=${DISPLAY:-:0}
      - LIBGL_ALWAYS_INDIRECT=0
      - IDA_USER_DIR=/ida/user
      - QT_QPA_PLATFORM=offscreen
    volumes:
      - ./src:/workspace/src:ro
      - ./tests:/workspace/tests:ro
      - ./examples:/workspace/examples:ro
      - ./tests/out:/workspace/tests/out
      - ida-user-92:/ida/user
    working_dir: /workspace
    ports:
      - "65434:65434"

  # IDA Pro 9.1 test runner
  idapro-tests:
    image: ghcr.io/mahmoudimus/idapro-linux:idapro-tests@sha256:6acc4756c48d3eecfbb85904361365e6f138844f784a93827597074d3d451ab2
    entrypoint: ["python3"]
    working_dir: /work
    environment:
      - CONTAINER_TIMEZONE=America/Los_Angeles
      - DISPLAY=host.docker.internal:0
      - QT_X11_NO_MITSHM=1
      - LIBGL_ALWAYS_INDIRECT=1
      - IDAUSR=/root/.idapro
      - PYTHONPATH=/app/ida/python:/work
      - PYTHONWARNINGS=ignore
    volumes:
      - ./src/ida_taskr:/root/.idapro/plugins/ida_taskr:ro
      - ./:/work

  # IDA Pro 9.2 test runner
  idapro-tests-9.2:
    image: ghcr.io/mahmoudimus/idapro-linux:idapro-tests-9.2@sha256:541790eb853f2a46ff713476c596cb3164d719bc33d5d3c4027687d5d9e2f1ba
    entrypoint: ["python3"]
    working_dir: /work
    environment:
      - CONTAINER_TIMEZONE=America/Los_Angeles
      - DISPLAY=host.docker.internal:0
      - QT_X11_NO_MITSHM=1
      - LIBGL_ALWAYS_INDIRECT=1
      - IDAUSR=/root/.idapro
      - PYTHONPATH=/app/ida/python:/work
      - PYTHONWARNINGS=ignore
    volumes:
      - ./src/ida_taskr:/root/.idapro/plugins/ida_taskr:ro
      - ./:/work

volumes:
  ida-user-91:
  ida-user-92:
